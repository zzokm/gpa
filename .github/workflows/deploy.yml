name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main
      - Feature-Testing
  workflow_dispatch:

permissions:
  contents: write

jobs:
  redirect-only:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create redirect pages
        run: |
          mkdir -p redirect-pages
          echo '<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="refresh" content="0;url=https://gpa.zokm.me"><title>Redirect</title><script>location.replace("https://gpa.zokm.me");</script></head><body><p><a href="https://gpa.zokm.me">Go to GPA Calculator</a></p></body></html>' > redirect-pages/index.html
          cp redirect-pages/index.html redirect-pages/404.html
          touch redirect-pages/.nojekyll

      - name: Deploy redirect (main → root)
        if: github.ref == 'refs/heads/main'
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: redirect-pages
          branch: gh-pages
          clean: true

      - name: Deploy redirect (Feature-Testing → beta)
        if: github.ref == 'refs/heads/Feature-Testing'
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: redirect-pages
          branch: gh-pages
          target-folder: beta
          clean: false
